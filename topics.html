<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>2. Topics &mdash; Multi-Party Encrypted Messaging Protocol design document 0.1-4-g75e6b2d</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/project.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1-4-g75e6b2d',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="copyright" title="Copyright" href="copyright.html" />
    <link rel="top" title="Multi-Party Encrypted Messaging Protocol design document 0.1-4-g75e6b2d" href="index.html" />
    <link rel="next" title="3. Protocol" href="protocol.html" />
    <link rel="prev" title="1. Background" href="background.html" />
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            "HTML-CSS": {
                // switch this off, it tends to make fonts too large
                matchFontHeight: false,
                // see https://docs.mathjax.org/en/v2.5-latest/options/HTML-CSS.html for valid values
                // most other ones don't look so good with the surrounding sans-serif Sphinx text
                availableFonts: ["Neo-Euler"],
                preferredFont: "Neo-Euler",
                webFont: "Neo-Euler",
            },
        });
    </script>

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="protocol.html" title="3. Protocol"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="background.html" title="1. Background"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Multi-Party Encrypted Messaging Protocol design document 0.1-4-g75e6b2d</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="topics">
<h1>2. Topics<a class="headerlink" href="#topics" title="Permalink to this headline">¶</a></h1>
<p>This chapter states the goals for our messaging protocol, the constraints we
chose, and discusses the issues that occur under these contexts.</p>
<div class="section" id="security-goals">
<h2>2.1. Security goals<a class="headerlink" href="#security-goals" title="Permalink to this headline">¶</a></h2>
<p>We do not try to provide confidentiality of session existence, membership, or
metadata, under any attack scenario. (For example, presently-known attacks that
break these include timing or other side channel analysis, or simply reading
the metadata generated by the normal operation of the transport.) However, we
try to avoid incompatibilities with any future systems that do provide those
properties, based on our knowledge of existing research and systems that
attempt or approximate these. <a class="footnote-reference" href="#mlen" id="id1">[1]</a></p>
<p>We aim to directly provide confidentiality of message content; authenticity of
membership, ordering, and content; and (later) a limited form of confidential
authenticity of ordering and content. An overview follows; we will expand on it
in more detail in subsequent chapters.</p>
<p>We achieve authenticity and confidentiality of message content, by using modern
standard cryptographic primitives with ephemeral session keys. The security of
these keys, and the authenticity of session membership and boundary ordering
(freshness), are achieved via an authenticated group key agreement protocol. We
do <em>not</em> use timestamps.</p>
<p>The authenticity of message ordering is achieved through the authenticity of
message content, together with some rules that enforce logical consistency.
That is, someone who can authenticate message contents (either an attacker via
secrets leak or a corrupt insider) must still adhere to those rules.</p>
<p>The authenticity of message membership (including reliability, consistency) is
achieved through the authenticity of message ordering, together with some rules
that ensure liveness using timeout warnings and continual retries. This differs
from previous approaches <a class="reference internal" href="references.html#mpom" id="id2">[09MPOM]</a> <a class="reference internal" href="references.html#gotr" id="id3">[13GOTR]</a> which achieve those via a separate
cryptographic mechanism. We believe that our approach is a cleaner separation
of concerns, requiring <em>no extra cryptography</em> beyond author authentication and
re-using basic concepts from time-tested reliability protocols such as TCP.</p>
<p>Our choice of mechanisms are intended to retain all these properties when under
an active attack on the communication transport. Under stronger attacks, we
have lower but still reasonable levels of protection:</p>
<dl class="docutils">
<dt>Under identity secrets leak against some targets (and active attack):</dt>
<dd><dl class="first last docutils">
<dt>Older sessions:</dt>
<dd><ul class="first last simple">
<li>Retain all relevant security properties.</li>
</ul>
</dd>
<dt>Current sessions:</dt>
<dd><ul class="first last simple">
<li>Retain all relevant security properties until the next membership change;</li>
<li>[+] From the next change onwards, properties are as (a), since in our
system membership changes require identity secrets to execute.</li>
</ul>
</dd>
<dt>Newer sessions (a):</dt>
<dd><ul class="first last simple">
<li>[x] Attacker can open/join sessions as the targets of the leak, and read
and participate those sessions;</li>
<li>Attacker <em>cannot</em> open/join sessions as non-targets (those unaffected by
the leak), not even with the compromised targets;</li>
<li>Retain all relevant security properties, for sessions whose establishment
was not actively compromised.</li>
</ul>
</dd>
</dl>
</dd>
<dt>Under session secrets leak against some targets (and active attack) (b):</dt>
<dd><dl class="first last docutils">
<dt>Older sessions:</dt>
<dd><ul class="first last simple">
<li>Retain all relevant security properties.</li>
</ul>
</dd>
<dt>Current sessions:</dt>
<dd><ul class="first last simple">
<li>[+; partly x] Attacker can read session events;</li>
<li>[+; partly x] Attacker can participate as targets;</li>
<li>Attacker <em>cannot</em> participate as non-targets.</li>
</ul>
</dd>
<dt>Newer sessions:</dt>
<dd><ul class="first last simple">
<li>[+] as (a); our session secrets unfortunately include identity secrets.</li>
</ul>
</dd>
</dl>
</dd>
<dt>Under insider corruption (and under active attack):</dt>
<dd><p class="first">As (b) except that entries marked imperfect cannot be improved upon. More
specifically, the properties we <em>do</em> retain are:</p>
<ul class="simple">
<li>Some limited protection against false claims/omissions about ordering;</li>
<li>(future work) Retain confidential authenticity of ordering and content.</li>
</ul>
<p class="last">Note that these apply to all lesser attacks too; we mention them explicitly
here so that this section is less depressing.</p>
</dd>
</dl>
<div class="line-block">
<div class="line">[x] unavoidable, as explained in the previous chapter.</div>
<div class="line">[+] imperfect, theoretically improvable, but we have no immediate plans to.</div>
</div>
<table class="docutils footnote" frame="void" id="mlen" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>We do use an opportunistic exponential padding scheme that hides the
lowest bits of message length, but have not analysed this under a strong
adversarial model.</td></tr>
</tbody>
</table>
</div>
<div class="section" id="distributed-systems">
<span id="id4"></span><h2>2.2. Distributed systems<a class="headerlink" href="#distributed-systems" title="Permalink to this headline">¶</a></h2>
<p>Security properties are meant to detect <em>incorrect behaviour</em>; but conflicts in
naively-implemented distributed systems can happen <em>even when</em> everyone behaves
correctly. If we don&#8217;t explicitly identify and resolve these situations as <em>not
a security problem</em>, but instead allow our security mechanisms to warn or fail
in their presence, we reduce the usefulness of the latter. In other words, a
warning which is 95% likely to be a false positive, is useless information and
a very bad user experience that may push them towards less secure applications.</p>
<p>Generally in a distributed system, events may happen concurrently, so ideally a
causal order (directed acyclic graph) rather than a total order (line) should
be used to represent the ordering of events. We do this for messages, and this
component of our system may be directly reused for asynchronous messaging.</p>
<p>However, group key agreements (GKAs), which is our membership change mechanism,
historically have not been developed with this consideration in mind. A direct
solution would define the result of merging two concurrent operations, and give
an algorithm for both sides of the fork to execute, to reach this result state.
But we could not find literature that even mentions this problem, and we are
unsure how to begin to approach it. Based on our moderate experience, it seems
feasible at least that any solution would be highly specific to the GKA used,
limiting our future options for replacing cryptographic components.</p>
<p>For now, we give up causal ordering for membership operations, and instead
enforce a linear ordering for them. To make this easier, we restrict ourselves
to a group transport channel, that takes responsibility for the delivery of
channel events (messages and membership changes), reliably and in a consistent
order. <a class="footnote-reference" href="#xmpp" id="id5">[2]</a> We do not <em>assume</em> this; we detect any deviation from it and
notify the user, but our system is efficient if the transport is honest.</p>
<p>Beyond this, there are several more non-security distributed systems issues,
that relate to the integration of cryptographic logic in the context of a group
transport channel. These situations all have the potential to corrupt the
internal state consistency of a naive implementation:</p>
<ul class="simple">
<li>Two members start different operations concurrently (as mentioned above);</li>
<li>Two members try to complete an operation concurrently, in different ways;
e.g. &#8220;send the final packet&#8221; vs. &#8220;send a request to abort&#8221;;</li>
<li>A user enters the channel during an operation;</li>
<li>A user leaves the channel during an operation;</li>
<li>A member starts an operation and sends the first packet to the other channel
members <span class="math">\(M\)</span>, but when others receive it the membership has changed to
<span class="math">\(M'\)</span>, or there was another operation that jumped in before it;</li>
<li>Different operation packets (initial or final) are decodeable by different
members, some of which are not part of the cryptographic session. If we&#8217;re
not careful, they will think different things about the state of the session,
or of others&#8217; sessions;</li>
<li>Any of the above things could happen at the same time.</li>
</ul>
<p>We must design graceful, low-failure-rate solutions for all of them. Individual
solutions to each of these are fairly straightforward, but making sure that
these interact with each other in a sane way is more complex. Then, there is
the task of describing the intended behaviour <em>precisely</em>. Only when we have a
precise idea on what is <em>supposed</em> to happen, can we construct a concrete
system that isn&#8217;t fragile, i.e. require mountains of patches for corner cases
ignored during the initial hasty naive implementations.</p>
<table class="docutils footnote" frame="void" id="xmpp" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[2]</a></td><td>For example, XMPP MUC would be suitable for this purpose, since one
single server keeps a consistent order for the channel. In IRC, there may
be multiple servers that opportunistically forward messages from clients
to each other, without trying to agree on a consistent order.</td></tr>
</tbody>
</table>
</div>
<div class="section" id="user-experience">
<h2>2.3. User experience<a class="headerlink" href="#user-experience" title="Permalink to this headline">¶</a></h2>
<p>Independently of any actual attack or security warning, the distributed nature
of our system requires us to consider how to represent <em>correct</em> information to
users. Displaying inaccurate or vague information is a security risk <em>even
without an attacker</em> because it can lead the user to believe incorrect things.</p>
<p>Here, we give an overview of these issues and our suggested solutions for them.
Avoiding any of these topics is always an option, which case the application
will look like &#8211; <em>and be as insecure as</em> &#8211; existing applications that do the
same.</p>
<dl class="docutils">
<dt>Real parents of a message</dt>
<dd><p class="first">Some messages may not be displayed immediately below the one(s) that they are
actually sent after, i.e. that the author saw when sending it.</p>
<p class="last">Our suggestion: (a) allow the user to select a message (e.g. via mouse click,
long press or keyboard) upon which all non-ancestors are grayed out; and (b)
annotate the messages whose parents are not equal to the set {the preceding
message in the UI}, as a hint for the user to perform the selection.</p>
</dd>
<dt>Messages sent before a membership change completes, but received afterwards</dt>
<dd><p class="first">Obviously, this message has a different membership from the current session,
and it would be wrong not to display this difference.</p>
<p class="last">Our suggestion: (a) when an operation completes, issue a UI notice about it
inline in the messages view; (b) allow the user to select a message to see
its membership, instead of trying to infer it from the session membership and
any member change notices; and (c) annotate such messages as a hint for the
user to perform the selection.</p>
</dd>
<dt>Progress and result of a membership change operation</dt>
<dd><p class="first">If the user starts an operation then immediately sends a message, this is
still encrypted to the <em>old</em> membership. Unless we explicitly make it clear
that operations take a finite time, they may not realise this.</p>
<p class="last">Our suggestion: issue UI notices inline in the messages view, when the user
proposes an operation and when it is rejected, is accepted (starts), fails or
succeeds; or (optionally) also when <em>others&#8217;</em> operations are rejected, are
accepted, fail or succeed.</p>
</dd>
<dt>Messages received out-of-order</dt>
<dd><p class="first">Some messages are sent, but the sent-later ones are received earlier.</p>
<p class="last">Our suggestion: simply ignore the messages that are received too early, until
the missing gaps are filled. This might seem counter-intuitive, but there are
many reasons that this is the best behaviour, discussed in <a class="reference internal" href="references.html#msg-2oo" id="id6">[msg-2oo]</a>. There
are some other options, but we believe these are all strictly worse.</p>
</dd>
<dt>Messages not yet acknowledged by all of its intended readers</dt>
<dd><p class="first">Here, we are unsure if everyone received what we sent, or received the same
messages that we received from others.</p>
<p class="last">Our suggestion: (a) allow the user to select a message to see who has not yet
acknowledged it, out of its membership; (b) annotate such messages as a hint
for the user to perform the selection, after a grace timeout because it&#8217;s
impossible to satisfy this immediately; and optionally (c) show a progress
meter for this condition for every message we send.</p>
</dd>
<dt>Users not responding to heartbeats</dt>
<dd><p class="first">This helps to detect transports dropping our messages.</p>
<p class="last">Our suggestion: in the users view, gray out expired users.</p>
</dd>
</dl>
<p>A more detailed discussion of these topics is given at <a class="reference internal" href="references.html#msg-hci" id="id7">[msg-hci]</a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/Mega_logo_gradient.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">2. Topics</a><ul>
<li><a class="reference internal" href="#security-goals">2.1. Security goals</a></li>
<li><a class="reference internal" href="#distributed-systems">2.2. Distributed systems</a></li>
<li><a class="reference internal" href="#user-experience">2.3. User experience</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="background.html"
                        title="previous chapter">1. Background</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="protocol.html"
                        title="next chapter">3. Protocol</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/topics.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="protocol.html" title="3. Protocol"
             >next</a> |</li>
        <li class="right" >
          <a href="background.html" title="1. Background"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Multi-Party Encrypted Messaging Protocol design document 0.1-4-g75e6b2d</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; <a href="copyright.html">Copyright</a> 2015, Mega Limited, Auckland, New Zealand.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.5.
    </div>
  </body>
</html>